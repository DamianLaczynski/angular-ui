// =============================================================================
// DataGrid Component Styles (Fluent 2 Design System)
// =============================================================================

@use '../utils/variables' as *;
@use '../utils/mixins' as *;
@use '../utils/functions' as *;

// =============================================================================
// DataGrid Container
// =============================================================================

.data-grid {
  display: flex;
  flex-direction: column;
  width: 100%;
  min-width: 0;
  background: var(--color-neutral-background-rest);

  // Size variants
  &--small {
    font-size: $font-size-200;

    .data-grid__header-cell {
      &--selection {
        padding: 8px 8px 9px 8px;
      }
    }

    .data-grid__cell {
      padding: $spacing-1 $spacing-2;
    }
  }

  &--medium {
    font-size: $font-size-300;

    .data-grid__header-cell {
      &--selection {
        padding: 8px 16px 9px 16px;
      }
    }
  }

  &--large {
    font-size: $font-size-300;

    .data-grid__header-cell {
      &--selection {
        padding: 8px 16px 9px 16px;
      }
    }

    .data-grid__cell {
      padding: $spacing-3 $spacing-4;
    }
  }

  // Style variants
  &--striped {
    .data-grid__row:nth-child(even) {
      background: var(--color-neutral-background-selected);
    }
  }

  &--bordered {
    .data-grid__header-cell,
    .data-grid__cell {
      border-right: 1px solid var(--color-neutral-stroke-rest);

      &:last-child {
        border-right: none;
      }
    }
  }

  &--hoverable {
    .data-grid__row:hover:not(.data-grid__row--disabled) {
      background: var(--color-subtle-background-hover);
    }
  }
}

// =============================================================================
// Scroll Container
// =============================================================================

.data-grid__scroll-container {
  display: flex;
  flex-direction: column;
  width: 100%;
  min-width: 0;
  overflow-x: auto;
  overflow-y: auto; // Allow vertical scrolling for large datasets
}

// =============================================================================
// Header
// =============================================================================

.data-grid__header {
  align-items: center;
  background: var(--color-neutral-background-rest);
  overflow: visible; // Allow dropdown panels to be visible
  position: relative; // Create positioning context
  flex-shrink: 0; // Prevent header from shrinking

  &--sticky {
    position: sticky;
    top: 0;
    z-index: 10;
  }
}

.data-grid__header-row {
  display: flex;
  width: 100%;
  min-width: max-content; // Ensure row takes full width
  border-bottom: 1px solid var(--color-neutral-stroke-rest);
}

.data-grid__header-cell {
  display: flex;
  align-items: stretch;
  background: transparent;
  overflow: visible;
  flex: 1 1 auto;
  box-sizing: border-box; // Include padding in width calculation
  position: relative; // For resize handle positioning
  min-width: 0; // Allow shrinking below content size

  &--selection {
    padding: 8px 16px 9px 16px;
    flex: 0 0 auto;
    min-width: auto;
  }

  &--expand {
    padding: 5px 8px 6px 8px;
    flex: 0 0 40px;
    min-width: 40px;
    max-width: 40px;
  }

  // Sorted state is now handled by ButtonComponent with selected prop
}

.data-grid__header-label-content {
  display: flex;
  min-height: 33px;
  padding: 5px 8px 6px 8px;
  justify-content: space-between;
  align-items: center;
  gap: $spacing-1;
  width: 100%;
  min-width: 0; // Allow shrinking
  box-sizing: border-box; // Include padding in width calculation
}

.data-grid__header-actions {
  display: flex;
  align-items: center;
  gap: $spacing-05;
  flex-shrink: 0;
}

.data-grid__header-text {
  display: flex;
  flex: 1;
  flex-direction: column;
  justify-content: center;
  color: var(--color-neutral-foreground-rest);
  font-size: $font-size-300;
  font-family: $font-family-base;
  font-weight: $font-weight-regular;
  line-height: $line-height-300;
  word-wrap: break-word;
  text-overflow: ellipsis;
  white-space: nowrap;
  min-width: 0;
}

// Sort button uses ButtonComponent styles
// Additional data-grid specific styling if needed
.data-grid__header-sort-button {
  flex-shrink: 0;

  &.button--selected {
    ui-icon {
      color: var(--color-brand-primary) !important;
    }
  }
}

// Filter operator selector in header
.data-grid__header-filter-operator {
  flex-shrink: 0;
}

// Resize handle
.data-grid__header-resize-handle {
  position: absolute;
  top: 0;
  right: 0;
  width: 4px;
  height: 100%;
  cursor: col-resize;
  z-index: 1;
  background: transparent;
  @include smooth-hover;

  &:hover {
    background: var(--color-brand-primary);
  }

  &:active {
    background: var(--color-brand-primary);
    opacity: 0.8;
  }
}

// =============================================================================
// Filter Row
// =============================================================================

.data-grid__filter-row {
  display: flex;
  width: 100%;
  min-width: max-content; // Ensure row takes full width
  background: var(--color-neutral-background-hover);
  border-bottom: 1px solid var(--color-neutral-stroke-rest);
  padding: 0 0;
  overflow: visible; // Allow dropdown panels to be visible
  position: relative; // Create positioning context
  flex-shrink: 0; // Prevent filter row from shrinking
}

.data-grid__filter-cell {
  display: flex;
  align-items: stretch;
  padding: $spacing-1 $spacing-2;
  overflow: visible; // Allow dropdown/date picker panels to be visible - inputs are controlled by max-width
  flex: 1 1 auto;
  position: relative; // Create positioning context for dropdown panels
  max-width: 100%; // Ensure cell doesn't exceed column width
  box-sizing: border-box; // Include padding in width calculation
  min-width: 0; // Allow shrinking below content size

  &--selection {
    padding: $spacing-1 $spacing-4;
    flex: 0 0 auto;
    min-width: auto;
    max-width: none;

    &::after {
      content: '';
      width: 20px;
      height: 20px;
    }
  }

  &--expand {
    padding: $spacing-1 $spacing-2;
    flex: 0 0 40px;
    min-width: 40px;
    max-width: 40px;
  }
}

.data-grid__filter-wrapper {
  width: 100%;
  min-width: 0; // Allow shrinking
  box-sizing: border-box; // Include padding in width calculation
}

.data-grid__filter-separator {
  flex-shrink: 0;
  color: var(--color-neutral-foreground2-rest);
  font-size: $font-size-200;
  padding: 0 $spacing-1;
  white-space: nowrap;
  flex: 0 0 auto; // Don't grow or shrink
}

// Size variants for filter row
.data-grid {
  &--small {
    .data-grid__filter-row {
      padding: 0 0;
    }

    .data-grid__filter-cell {
      padding: $spacing-05 $spacing-1;
      min-height: 28px;

      &--selection {
        padding: $spacing-05 $spacing-2;
        min-width: 37px;
      }
    }
  }

  &--medium {
    .data-grid__filter-row {
      padding: 0 0;
    }

    .data-grid__filter-cell {
      padding: $spacing-1 $spacing-2;
      min-height: 36px;

      &--selection {
        padding: $spacing-1 $spacing-4;
      }
    }
  }

  &--large {
    .data-grid__filter-row {
      padding: 0 0;
    }

    .data-grid__filter-cell {
      padding: $spacing-2 $spacing-2;
      min-height: 44px;

      &--selection {
        padding: $spacing-2 $spacing-4;
      }
    }
  }
}

// Bordered variant for filters
.data-grid--bordered {
  .data-grid__filter-cell {
    border-right: 1px solid var(--color-neutral-stroke-rest);

    &:last-child {
      border-right: none;
    }
  }
}

// =============================================================================
// Rows Container
// =============================================================================

.data-grid__rows-container {
  position: relative;
  width: 100%;
  flex-shrink: 0; // Prevent rows container from shrinking
  overflow-y: visible; // Allow dropdown panels to be visible (if any filters in rows)
}

// =============================================================================
// Row
// =============================================================================

.data-grid__row {
  display: flex;
  align-items: stretch;
  border-bottom: 1px solid var(--color-neutral-stroke-rest);
  @include smooth-hover;
  cursor: default;
  outline: none;
  width: 100%;
  min-width: max-content; // Ensure row takes full width

  // Only show pointer cursor when row is clickable
  .data-grid--hoverable &:not(&--disabled) {
    cursor: pointer;
  }

  &--selected {
    background: var(--color-neutral-background-brand-selected);
  }

  &--disabled {
    cursor: not-allowed;
    opacity: 0.6;

    .data-grid__cell {
      color: var(--color-neutral-foreground-disabled);
    }
  }

  &--hovered:not(&--disabled) {
    background: var(--color-subtle-background-hover);
  }

  // Fluent 2 Focus Indicator
  &:focus-visible {
    position: relative;
    z-index: 1;
    @include focus-ring(0px);
  }

  &:last-child {
    border-bottom: none;
  }
}

// =============================================================================
// Cell
// =============================================================================

.data-grid__cell {
  display: flex;
  align-items: stretch;
  padding: $spacing-2 $spacing-2;
  flex: 1 1 auto;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  box-sizing: border-box; // Include padding in width calculation
  min-width: 0; // Allow shrinking below content size

  &--selection {
    padding: $spacing-3 $spacing-4;
    flex: 0 0 auto;
    min-width: auto;
    max-width: none;
  }

  &--expand {
    padding: $spacing-2;
    flex: 0 0 40px;
    min-width: 40px;
    max-width: 40px;
    justify-content: center;
  }

  &--none {
    .data-grid__cell-text {
      color: var(--color-neutral-foreground2-rest);
      font-size: $font-size-300;
      line-height: $line-height-300;
    }
  }
}

.data-grid__cell-content {
  display: flex;
  align-items: center;
  gap: $spacing-2;
  width: 100%;
  min-width: 0; // Allow shrinking
  box-sizing: border-box; // Include padding in width calculation
}

.data-grid__cell-text {
  flex: 1;
  text-overflow: ellipsis;
  white-space: nowrap;
  color: inherit;
  font-size: inherit;
  line-height: inherit;
}

.data-grid__actions-cell {
  display: flex;
  align-items: center;
  gap: $spacing-1;
  justify-content: flex-end;
  width: 100%;
}

// =============================================================================
// Expandable Rows
// =============================================================================

.data-grid__row-details {
  background: var(--color-neutral-background-selected);
  border-bottom: 1px solid var(--color-neutral-stroke-rest);
  border-top: 1px solid var(--color-neutral-stroke-rest);
  margin-top: -1px; // Overlap with row border
  @include slide-down($duration-normal, $easing-ease-in-out);
}

.data-grid__row-details-content {
  padding: $spacing-4 $spacing-4;
  padding-left: calc(40px + $spacing-4); // Align with expand column
  color: var(--color-neutral-foreground-rest);
  font-size: $font-size-300;
  line-height: $line-height-300;

  .data-grid--small & {
    padding: $spacing-3 $spacing-3;
    padding-left: calc(40px + $spacing-3);
    font-size: $font-size-200;
    line-height: $line-height-200;
  }

  .data-grid--large & {
    padding: $spacing-5 $spacing-5;
    padding-left: calc(40px + $spacing-5);
    font-size: $font-size-400;
    line-height: $line-height-400;
  }
}

// Adjust padding when selection column is present
.data-grid__row:has(.data-grid__cell--selection)
  + .data-grid__row-details
  .data-grid__row-details-content {
  padding-left: calc(40px + 48px + $spacing-4); // expand + selection + padding

  .data-grid--small & {
    padding-left: calc(40px + 48px + $spacing-3);
  }

  .data-grid--large & {
    padding-left: calc(40px + 48px + $spacing-5);
  }
}
