<!-- Node container with modifiers -->
<div [class]="nodeClasses()">
  <!-- Wrapper -->
  <div
    class="node__wrapper"
    [class]="dropZone() ? getDropZoneClasses() : ''"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
  >
    <!-- Selection Indicator -->
    @if (showSelectionIndicator()) {
    <div class="node__indicator">
      @if (indicatorPosition() === 'horizontal' && node().selected) {
      <div class="node__selector" [style.width]="getSelectorWidth()"></div>
      } @if (indicatorPosition() === 'vertical' && node().selected) {}
    </div>
    }

    <!-- Content (as button or div) -->
    @if (asButton()) {
    <button
      type="button"
      [class]="contentClasses()"
      [disabled]="node().disabled || false"
      [attr.aria-label]="node().label"
      [attr.draggable]="draggable() && !node().disabled"
      (click)="onContentClick($event)"
      (dragstart)="onDragStart($event)"
      (dragend)="onDragEnd($event)"
      (drag)="onDrag($event)"
    >
      @if (contentTemplate()) {
      <!-- Custom content template -->
      <ng-container
        *ngTemplateOutlet="contentTemplate()!; context: { $implicit: node() }"
      ></ng-container>
      } @else {
      <!-- Default content -->
      @if (shouldShowIcon()) {
      <span class="node__icon">
        @if (node().selected) {
        <ui-icon [icon]="node().icon" [size]="size()" variant="filled" />
        } @else {
        <ui-icon [icon]="node().icon" [size]="size()" variant="regular" />
        }
      </span>
      } @if (shouldShowLabel()) {
      <span class="node__label">{{ node().label }}</span>
      }

      <!-- Close button -->
      @if (node().closable) {
      <button
        class="node__close"
        (click)="onCloseClick($event)"
        [attr.aria-label]="'Zamknij ' + node().label"
      >
        <ui-icon icon="dismiss" size="small" />
      </button>
      }

      <!-- Quick Actions -->
      @if (showQuickActions() && quickActionsTemplate()) {
      <div class="node__quick-actions">
        <ng-container
          *ngTemplateOutlet="quickActionsTemplate()!; context: { $implicit: node() }"
        ></ng-container>
      </div>
      } }
    </button>
    } @else {
    <div
      [class]="contentClasses()"
      [attr.tabindex]="getTabIndex()"
      [attr.role]="getRole()"
      [attr.aria-selected]="node().selected ? 'true' : null"
      [attr.aria-disabled]="node().disabled ? 'true' : null"
      [attr.draggable]="draggable() && !node().disabled"
      (click)="onContentClick($event)"
      (dragstart)="onDragStart($event)"
      (dragend)="onDragEnd($event)"
      (drag)="onDrag($event)"
    >
      @if (contentTemplate()) {
      <!-- Custom content template -->
      <ng-container
        *ngTemplateOutlet="contentTemplate()!; context: { $implicit: node() }"
      ></ng-container>
      } @else {
      <!-- Default content -->
      @if (shouldShowIcon()) {
      <span class="node__icon">
        @if (node().selected) {
        <ui-icon [icon]="node().icon" [size]="size()" variant="filled" />
        } @else {
        <ui-icon [icon]="node().icon" [size]="size()" variant="regular" />
        }
      </span>
      } @if (shouldShowLabel()) {
      <span class="node__label">{{ node().label }}</span>
      }

      <!-- Close button -->
      @if (node().closable) {
      <button
        class="node__close"
        (click)="onCloseClick($event)"
        [attr.aria-label]="'Zamknij ' + node().label"
      >
        <ui-icon icon="dismiss" size="small" />
      </button>
      }

      <!-- Quick Actions -->
      @if (showQuickActions() && quickActionsTemplate()) {
      <div class="node__quick-actions">
        <ng-container
          *ngTemplateOutlet="quickActionsTemplate()!; context: { $implicit: node() }"
        ></ng-container>
      </div>
      } }
    </div>
    }
  </div>
</div>
