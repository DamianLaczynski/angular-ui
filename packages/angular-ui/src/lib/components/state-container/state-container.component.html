@if (state().isLoading && loadingOverlay()) {
  <!-- Loading overlay mode: show content with overlay on top -->
  <ui-loading-state
    [title]="loadingTitle()"
    [description]="loadingDescription()"
    [size]="size()"
    [overlay]="true"
    [blurContent]="loadingBlurContent()"
    [fullScreen]="loadingFullScreen()"
    [isLoading]="true"
  >
    @if (loadingContentTemplate(); as contentTemplate) {
      <ng-template #content>
        <ng-container *ngTemplateOutlet="contentTemplate; context: stateContext()"></ng-container>
      </ng-template>
    }
    <!-- Content below overlay -->
    @if (dataTemplate(); as template) {
      <ng-container *ngTemplateOutlet="template; context: stateContext()"></ng-container>
    } @else {
      <ng-content />
    }
  </ui-loading-state>
} @else if (state().isLoading) {
  <!-- Loading non-overlay mode: show only loading state -->
  <ui-loading-state
    [title]="loadingTitle()"
    [description]="loadingDescription()"
    [size]="size()"
    [overlay]="false"
    [blurContent]="loadingBlurContent()"
    [fullScreen]="loadingFullScreen()"
    [isLoading]="true"
  >
    @if (loadingContentTemplate(); as contentTemplate) {
      <ng-template #content>
        <ng-container *ngTemplateOutlet="contentTemplate; context: stateContext()"></ng-container>
      </ng-template>
    }
  </ui-loading-state>
} @else if (state().isError) {
  <ui-error-state
    [title]="errorTitle()"
    [description]="errorDescription() || state().error || ''"
    [icon]="errorIcon() || 'error_circle'"
    [size]="size()"
    [primaryAction]="errorPrimaryAction()"
    [secondaryAction]="errorSecondaryAction()"
  >
    @if (errorContentTemplate(); as contentTemplate) {
      <ng-template #content>
        <ng-container *ngTemplateOutlet="contentTemplate; context: stateContext()"></ng-container>
      </ng-template>
    }
  </ui-error-state>
} @else if (shouldShowInitial()) {
  @if (initialTemplate(); as template) {
    <ng-container *ngTemplateOutlet="template; context: stateContext()"></ng-container>
  }
} @else if (shouldShowEmpty()) {
  <ui-empty-state
    [title]="emptyTitle()"
    [description]="emptyDescription()"
    [icon]="emptyIcon()"
    [size]="size()"
    [primaryAction]="emptyPrimaryAction()"
    [secondaryAction]="emptySecondaryAction()"
  >
    @if (emptyContentTemplate(); as contentTemplate) {
      <ng-template #content>
        <ng-container *ngTemplateOutlet="contentTemplate; context: stateContext()"></ng-container>
      </ng-template>
    }
  </ui-empty-state>
} @else {
  @if (dataTemplate(); as template) {
    <ng-container *ngTemplateOutlet="template; context: stateContext()"></ng-container>
  } @else {
    <ng-content />
  }
}
