<ui-field
  [fieldType]="'date'"
  [label]="label()"
  [placeholder]="placeholder()"
  [helpText]="helpText()"
  [(errorText)]="errorText"
  [required]="required()"
  [disabled]="disabled()"
  [readonly]="readonly()"
  [id]="id()"
  [name]="name()"
  [size]="size()"
  [variant]="variant()"
>
  <div class="input-wrapper" [class]="wrapperClasses">
    <input
      #triggerElement
      class="input"
      type="text"
      [id]="id()"
      [name]="name()"
      [placeholder]="placeholder()"
      [required]="required()"
      [disabled]="disabled()"
      [readonly]="readonly()"
      [value]="displayText()"
      [attr.aria-label]="ariaLabel() || label()"
      [attr.aria-describedby]="ariaDescribedBy()"
      [attr.aria-invalid]="!!errorText()"
      [attr.aria-expanded]="isOpen()"
      [attr.aria-haspopup]="'dialog'"
      (click)="togglePanel()"
      (input)="onDateRangeInputChange($event)"
      (blur)="onBlur($event)"
      (focus)="onFocus($event)"
      (keydown)="onKeyDown($event)"
    />
    <!-- Actions: Calendar icon and clear button -->
    @if (!disabled() && !readonly()) {
    <div class="field__actions">
      <!-- Calendar Icon Button -->
      <ui-action-button
        [size]="size()"
        [icon]="'calendar'"
        (click)="togglePanel()"
      ></ui-action-button>
      <!-- Clear Button -->
      @if (value && (value.startDate || value.endDate)) {
      <ui-action-button [icon]="'dismiss'" [size]="size()" (click)="clear()"></ui-action-button>
      }
    </div>
    }
  </div>
</ui-field>

<!-- Date Range Picker Panel - rendered via CDK Overlay -->
<ng-template #panelTemplate>
  <div class="date-range-panel" [attr.data-size]="size()" cdkTrapFocus cdkTrapFocusAutoCapture>
    <!-- Calendar Section -->
    <div class="date-range-panel__calendar">
      <ui-calendar
        [currentMonth]="currentMonth()"
        [selectedDate]="null"
        [startDate]="startDate()"
        [endDate]="endDate()"
        [hoveredDate]="hoveredDate()"
        [calendarView]="calendarView()"
        [min]="min()"
        [max]="max()"
        [size]="size()"
        [showMonthYearPicker]="showMonthYearPicker()"
        [isDayInHoverRangeFn]="isDayInHoverRange.bind(this)"
        (dateSelect)="onCalendarDateSelect($event)"
        (monthSelect)="onCalendarMonthSelect($event)"
        (yearSelect)="onCalendarYearSelect($event)"
        (previousMonth)="onCalendarPreviousMonth()"
        (nextMonth)="onCalendarNextMonth()"
        (previousYear)="onCalendarPreviousYear()"
        (nextYear)="onCalendarNextYear()"
        (previousYearRange)="onCalendarPreviousYearRange()"
        (nextYearRange)="onCalendarNextYearRange()"
        (switchToMonthsView)="onCalendarSwitchToMonthsView()"
        (switchToYearsView)="onCalendarSwitchToYearsView()"
        (switchToDaysView)="onCalendarSwitchToDaysView()"
        (dateHover)="onCalendarDateHover($event)"
        (dateLeave)="onCalendarDateLeave()"
      ></ui-calendar>
    </div>
  </div>
</ng-template>
